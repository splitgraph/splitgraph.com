export const meta = {
  title: "TOC Testing",
  id: "toc_testing",
};

# Prism testing

## Python

```py
partial_failure: Optional[BaseException] = None
try:
    successful = self.download_objects(
        upstream_manager, objects_to_fetch=to_fetch, object_locations=object_locations
    )
    difference = []
except IncompleteObjectDownloadError as e:
    successful = e.successful_objects
    difference = list(set(to_fetch).difference(successful))
    if difference:
        if e.reason:
            partial_failure = e.reason
        else:
            partial_failure = self._generate_download_error(table, difference)
except Exception as e:
    successful = self.get_downloaded_objects(to_fetch)
    difference = list(set(to_fetch).difference(successful))
    partial_failure = self._generate_download_error(table, difference, cause=e)

logging.info("Did a thing", thing // 42.0)

# No matter what, claim the space required by the newly downloaded objects.
self._increase_cache_occupancy(successful)
```

## Javascript

```js
// Tell the world that you want to say hello
console.log("Hello world");
```

## Bash

```bash
$ sgr sql --set-thing 25 "SELECT * FROM table"
$ sgr sql $(cat thing.sql)
```

## YAML

```yaml
version: '3'
services:
  engine:
    image: splitgraph/engine:${DOCKER_TAG-stable}
    ports:
      - '0.0.0.0:5432:5432'
    environment:
      - POSTGRES_USER=sgr
      - POSTGRES_PASSWORD=supersecure
      - POSTGRES_DB=splitgraph
      - SG_LOGLEVEL=INFO
    expose:
      - 5432
  postgrest:
    image: postgrest/postgrest:latest
    ports:
      - '0.0.0.0:8080:8080'
    volumes:
      - ./postgrest.conf:/etc/postgrest.conf
```

## INI

```ini
SG_LOGLEVEL=INFO

[remote:thing]

SG_ENGINE_USER=splitgraph
SG_ENGINE_POOL=42
```

## Dockerfile

```docker
FROM ubuntu:18.10 AS builder

RUN sudo apt-get update

FROM builder

CMD ["thing", "--yep"]
```

## SQL

```sql
SELECT
    -- Note we need to escape the closing curly brace here for the
    -- Splitfile executor.
    substring(alternatenames FROM ',([A-Z]{3\}),') AS iata_code,
    name,
    latitude,
    longitude,
    geonameid
FROM all_countries
WHERE feature_code = 'AIRP'
AND country_code = 'US'
AND substring(alternatenames FROM ',([A-Z]{3\}),') IS NOT NULL
```

## Splitfile

```sgr
# This is a Splitfile comment
# 'strings' and FROM keywords aren't highlighted.

# Connection string and FDW is highlighted

FROM MOUNT mongo_fdw originro:originpass@mongo:27017 '{"stuff": {
                "db": "origindb",
                "coll": "stuff",
                "schema": {
                    "name": "text",
                    "duration": "numeric",
                    "happy": "boolean"}}}'
    IMPORT {SELECT * FROM stuff} AS stuff

# Repo name in FROM IMPORT is highlighted, so are inline SQL comments

FROM splitgraph/geonames:latest IMPORT {
    SELECT
        -- Note we need to escape the closing curly brace here for the
        -- Splitfile executor.
        substring(alternatenames FROM ',([A-Z]{3\}),') AS iata_code,
        name,
        latitude,
        longitude,
        geonameid
    FROM all_countries
    WHERE feature_code = 'AIRP'
    AND country_code = 'US'
    AND substring(alternatenames FROM ',([A-Z]{3\}),') IS NOT NULL
} AS airports

# Schema names get highlighted as strings (since they reference SG images)
SQL {
    CREATE TABLE us_flights_2009 AS
    SELECT
        origin_airport AS origin_iata,
        ao.name AS origin_name,
        ao.latitude AS origin_lat,
        ao.longitude AS origin_lon,

        destination_airport AS destination_iata,
        ad.name AS destination_name,
        ad.latitude AS destination_lat,
        ad.longitude AS destination_lon,

        SUM(passengers) AS total_passengers,
        SUM(seats) AS total_seats,
        SUM(flights) AS flights
    FROM "splitgraph/domestic_us_flights:latest".flights f
        JOIN airports ao ON f.origin_airport = ao.iata_code
        JOIN airports ad ON f.destination_airport = ad.iata_code
    WHERE
        EXTRACT('year' FROM fly_month) = 2009
        GROUP BY origin_airport, destination_airport,
            ao.name, ao.latitude, ao.longitude,
            ad.name, ad.latitude, ad.longitude
}
```
